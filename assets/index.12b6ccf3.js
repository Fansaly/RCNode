var D=Object.defineProperty,F=Object.defineProperties;var y=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,x=Object.prototype.propertyIsEnumerable;var H=(s,t,r)=>t in s?D(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r,n=(s,t)=>{for(var r in t||(t={}))j.call(t,r)&&H(s,r,t[r]);if(C)for(var r of C(t))x.call(t,r)&&H(s,r,t[r]);return s},i=(s,t)=>F(s,y(t));import{R as o,u as P,a as _,m as k,j as S,A as O,b as u}from"./index.5e723353.js";import{f as q,T as z,D as B,c as G}from"./index.f08fdfc8.js";import{T as I}from"./index.ee603623.js";import{N as J}from"./index.4c9ba486.js";import{P as K}from"./index.4e8fd2e6.js";import"./Render.f1e72879.js";import"./TextField.b78d12af.js";import"./useFormControl.ee9cff0d.js";import"./SwitchBase.10d93e74.js";import"./Create.c02587ea.js";import"./ExpandMore.5276a59c.js";import"./Collapse.9bf0d35a.js";const M=(s={})=>{const[t,r]=o.useState(!1);return o.useEffect(()=>{const{threshold:g=20}=s,a=()=>{const l=document.documentElement.offsetHeight||document.body.offsetHeight,m=document.documentElement.scrollTop||document.body.scrollTop,d=window.innerHeight;l>d&&l-(d+m)<=g?r(!0):r(!1)};return document.addEventListener("scroll",a),()=>document.removeEventListener("scroll",a)},[s]),t},ne=()=>{const s=M(),{search:t}=P(),{isAuthed:r,accesstoken:g}=_(e=>e.auth),a=o.useRef(!1),l=o.useRef(!1),m=o.useRef(!1),d=o.useRef(1),[b,A]=o.useState(void 0),[L,T]=o.useState([]),[N,E]=o.useState("idle"),[p,h]=o.useState({open:!1,action:"create"}),[v,w]=o.useState({open:!1,status:"success",message:""}),R=async()=>{m.current=!1;const{data:e,err_msg:c}=await G({accesstoken:g,tab:p.topicTab,title:p.title,content:p.content});m.current||(e&&(T(f=>[e,...f]),h(f=>i(n({},f),{open:!1}))),w(f=>i(n({},f),{open:!0,status:e?"success":"error",message:e?"\u53D1\u5E03\u6210\u529F ^_^":c||"\u53D1\u5E03\u5931\u8D25 :("})))};return o.useEffect(()=>{a.current=!1,l.current=!1,d.current=1,T([]),A(k({search:t}))},[t]),o.useEffect(()=>{if(!b||a.current||l.current&&!s)return;m.current=!1;const e=new AbortController;return(async()=>{a.current=!0,E("loading");const{data:c}=await q({signal:e.signal,tab:b,page:d.current,limit:20,mdrender:!0});m.current||(c?(T(f=>l.current?[...f,c]:[c]),E("success"),l.current=!0,d.current+=1):E("error"),a.current=!1)})(),()=>{a.current=!1,m.current=!0,e.abort()}},[b,s]),S(O,{children:[S("div",{id:"container",children:[u("div",{className:"wrapper",children:u("div",{className:"topic-list-container",children:L.map((e,c)=>u(I,{items:e},c))})}),u("div",{className:"status wrapper",children:u(K,{status:N})})]}),r&&S(o.Fragment,{children:[u(z,{single:!0,visible:!p.open,notificationOpen:v.open,onCreate:()=>{h(e=>i(n({},e),{open:!0}))}}),u(B,i(n({},p),{onChange:e=>{h(c=>n(n({},c),e))},onSubmit:R,onClose:()=>{h(e=>i(n({},e),{open:!1}))}}))]}),u(J,i(n({},v),{onClose:()=>{w(e=>i(n({},e),{open:!1}))}}))]})};export{ne as default};
