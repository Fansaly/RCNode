var se=Object.defineProperty,ie=Object.defineProperties;var ce=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var de=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Y=(e,t,a)=>t in e?se(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,L=(e,t)=>{for(var a in t||(t={}))de.call(t,a)&&Y(e,a,t[a]);if(H)for(var a of H(t))le.call(t,a)&&Y(e,a,t[a]);return e},X=(e,t)=>ie(e,ce(t));import{e as C,_ as u,B as ue,h as x,k as N,l as M,n as D,aT as pe,b as r,p as v,c as V,i as j,r as U,g as B,d as k,P as me,D as ge,j as m,X as fe,G as Q,aO as Z,a as E,R as w,a6 as y,T as z,a8 as he,W as J,a7 as K,aU as xe,aV as ve,A as be,an as _,J as Ae,aW as ye}from"./index.5e723353.js";import{A as Re,P as Ce}from"./index.4e8fd2e6.js";import{d as we}from"./ExpandMore.5276a59c.js";import{d as Se}from"./Reply.9d43ef53.js";import{R as $e,T as _e}from"./Render.f1e72879.js";import{C as Ne}from"./Collapse.9bf0d35a.js";import"./TextField.b78d12af.js";import"./useFormControl.ee9cff0d.js";const Me=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],De=e=>{const{absolute:t,children:a,classes:o,flexItem:c,light:n,orientation:s,textAlign:i,variant:l}=e;return D({root:["root",t&&"absolute",l,n&&"light",s==="vertical"&&"vertical",c&&"flexItem",a&&"withChildren",a&&s==="vertical"&&"withChildrenVertical",i==="right"&&s!=="vertical"&&"textAlignRight",i==="left"&&s!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",s==="vertical"&&"wrapperVertical"]},pe,o)},Ie=C("div",{name:"MuiDivider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.absolute&&t.absolute,t[a.variant],a.light&&t.light,a.orientation==="vertical"&&t.vertical,a.flexItem&&t.flexItem,a.children&&t.withChildren,a.children&&a.orientation==="vertical"&&t.withChildrenVertical,a.textAlign==="right"&&a.orientation!=="vertical"&&t.textAlignRight,a.textAlign==="left"&&a.orientation!=="vertical"&&t.textAlignLeft]}})(({theme:e,ownerState:t})=>u({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(e.vars||e).palette.divider,borderBottomWidth:"thin"},t.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},t.light&&{borderColor:e.vars?`rgba(${e.vars.palette.dividerChannel} / 0.08)`:ue(e.palette.divider,.08)},t.variant==="inset"&&{marginLeft:72},t.variant==="middle"&&t.orientation==="horizontal"&&{marginLeft:e.spacing(2),marginRight:e.spacing(2)},t.variant==="middle"&&t.orientation==="vertical"&&{marginTop:e.spacing(1),marginBottom:e.spacing(1)},t.orientation==="vertical"&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},t.flexItem&&{alignSelf:"stretch",height:"auto"}),({theme:e,ownerState:t})=>u({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{position:"relative",width:"100%",borderTop:`thin solid ${(e.vars||e).palette.divider}`,top:"50%",content:'""',transform:"translateY(50%)"}}),({theme:e,ownerState:t})=>u({},t.children&&t.orientation==="vertical"&&{flexDirection:"column","&::before, &::after":{height:"100%",top:"0%",left:"50%",borderTop:0,borderLeft:`thin solid ${(e.vars||e).palette.divider}`,transform:"translateX(0%)"}}),({ownerState:e})=>u({},e.textAlign==="right"&&e.orientation!=="vertical"&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},e.textAlign==="left"&&e.orientation!=="vertical"&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})),Be=C("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.wrapper,a.orientation==="vertical"&&t.wrapperVertical]}})(({theme:e,ownerState:t})=>u({display:"inline-block",paddingLeft:`calc(${e.spacing(1)} * 1.2)`,paddingRight:`calc(${e.spacing(1)} * 1.2)`},t.orientation==="vertical"&&{paddingTop:`calc(${e.spacing(1)} * 1.2)`,paddingBottom:`calc(${e.spacing(1)} * 1.2)`})),ke=x.exports.forwardRef(function(t,a){const o=N({props:t,name:"MuiDivider"}),{absolute:c=!1,children:n,className:s,component:i=n?"div":"hr",flexItem:l=!1,light:f=!1,orientation:g="horizontal",role:d=i!=="hr"?"separator":void 0,textAlign:b="center",variant:A="fullWidth"}=o,R=M(o,Me),p=u({},o,{absolute:c,component:i,flexItem:l,light:f,orientation:g,role:d,textAlign:b,variant:A}),h=De(p);return r(Ie,u({as:i,className:v(h.root,s),role:d,ref:a,ownerState:p},R,{children:n?r(Be,{className:h.wrapper,ownerState:p,children:n}):null}))});var We=ke,G={},Le=j.exports;Object.defineProperty(G,"__esModule",{value:!0});var ee=G.default=void 0,ze=Le(V),Ee=U,Te=(0,ze.default)((0,Ee.jsx)("path",{d:"m18 7-1.41-1.41-6.34 6.34 1.41 1.41L18 7zm4.24-1.41L11.66 16.17 7.48 12l-1.41 1.41L11.66 19l12-12-1.42-1.41zM.41 13.41 6 19l1.41-1.41L1.83 12 .41 13.41z"}),"DoneAll");ee=G.default=Te;var P={},Ve=j.exports;Object.defineProperty(P,"__esModule",{value:!0});var te=P.default=void 0,je=Ve(V),Ue=U,Ge=(0,je.default)((0,Ue.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10h5v-2h-5c-4.34 0-8-3.66-8-8s3.66-8 8-8 8 3.66 8 8v1.43c0 .79-.71 1.57-1.5 1.57s-1.5-.78-1.5-1.57V12c0-2.76-2.24-5-5-5s-5 2.24-5 5 2.24 5 5 5c1.38 0 2.64-.56 3.54-1.47.65.89 1.77 1.47 2.96 1.47 1.97 0 3.5-1.6 3.5-3.57V12c0-5.52-4.48-10-10-10zm0 13c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z"}),"AlternateEmail");te=P.default=Ge;var F={},Pe=j.exports;Object.defineProperty(F,"__esModule",{value:!0});var T=F.default=void 0,Fe=Pe(V),Oe=U,qe=(0,Fe.default)((0,Oe.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"}),"OpenInNew");T=F.default=qe;const He=x.exports.createContext({});var ae=He;function Ye(e){return B("MuiAccordion",e)}const Xe=k("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]);var I=Xe;const Je=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","TransitionComponent","TransitionProps"],Ke=e=>{const{classes:t,square:a,expanded:o,disabled:c,disableGutters:n}=e;return D({root:["root",!a&&"rounded",o&&"expanded",c&&"disabled",!n&&"gutters"],region:["region"]},Ye,t)},Qe=C(me,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[{[`& .${I.region}`]:t.region},t.root,!a.square&&t.rounded,!a.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&:before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&:before":{display:"none"}},[`&.${I.expanded}`]:{"&:before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&:before":{display:"none"}}},[`&.${I.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e,ownerState:t})=>u({},!t.square&&{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}},!t.disableGutters&&{[`&.${I.expanded}`]:{margin:"16px 0"}})),Ze=x.exports.forwardRef(function(t,a){const o=N({props:t,name:"MuiAccordion"}),{children:c,className:n,defaultExpanded:s=!1,disabled:i=!1,disableGutters:l=!1,expanded:f,onChange:g,square:d=!1,TransitionComponent:b=Ne,TransitionProps:A}=o,R=M(o,Je),[p,h]=ge({controlled:f,default:s,name:"Accordion",state:"expanded"}),$=x.exports.useCallback(ne=>{h(!p),g&&g(ne,!p)},[p,g,h]),[W,...re]=x.exports.Children.toArray(c),oe=x.exports.useMemo(()=>({expanded:p,disabled:i,disableGutters:l,toggle:$}),[p,i,l,$]),O=u({},o,{square:d,disabled:i,disableGutters:l,expanded:p}),q=Ke(O);return m(Qe,u({className:v(q.root,n),ref:a,ownerState:O,square:d},R,{children:[r(ae.Provider,{value:oe,children:W}),r(b,u({in:p,timeout:"auto"},A,{children:r("div",{"aria-labelledby":W.props.id,id:W.props["aria-controls"],role:"region",className:q.region,children:re})}))]}))});var et=Ze;function tt(e){return B("MuiAccordionActions",e)}k("MuiAccordionActions",["root","spacing"]);const at=["className","disableSpacing"],rt=e=>{const{classes:t,disableSpacing:a}=e;return D({root:["root",!a&&"spacing"]},tt,t)},ot=C("div",{name:"MuiAccordionActions",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,!a.disableSpacing&&t.spacing]}})(({ownerState:e})=>u({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end"},!e.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})),nt=x.exports.forwardRef(function(t,a){const o=N({props:t,name:"MuiAccordionActions"}),{className:c,disableSpacing:n=!1}=o,s=M(o,at),i=u({},o,{disableSpacing:n}),l=rt(i);return r(ot,u({className:v(l.root,c),ref:a,ownerState:i},s))});var st=nt;function it(e){return B("MuiAccordionDetails",e)}k("MuiAccordionDetails",["root"]);const ct=["className"],dt=e=>{const{classes:t}=e;return D({root:["root"]},it,t)},lt=C("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),ut=x.exports.forwardRef(function(t,a){const o=N({props:t,name:"MuiAccordionDetails"}),{className:c}=o,n=M(o,ct),s=o,i=dt(s);return r(lt,u({className:v(i.root,c),ref:a,ownerState:s},n))});var pt=ut;function mt(e){return B("MuiAccordionSummary",e)}const gt=k("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]);var S=gt;const ft=["children","className","expandIcon","focusVisibleClassName","onClick"],ht=e=>{const{classes:t,expanded:a,disabled:o,disableGutters:c}=e;return D({root:["root",a&&"expanded",o&&"disabled",!c&&"gutters"],focusVisible:["focusVisible"],content:["content",a&&"expanded",!c&&"contentGutters"],expandIconWrapper:["expandIconWrapper",a&&"expanded"]},mt,t)},xt=C(fe,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e,ownerState:t})=>{const a={duration:e.transitions.duration.shortest};return u({display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],a),[`&.${S.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${S.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${S.disabled})`]:{cursor:"pointer"}},!t.disableGutters&&{[`&.${S.expanded}`]:{minHeight:64}})}),vt=C("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e,ownerState:t})=>u({display:"flex",flexGrow:1,margin:"12px 0"},!t.disableGutters&&{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${S.expanded}`]:{margin:"20px 0"}})),bt=C("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${S.expanded}`]:{transform:"rotate(180deg)"}})),At=x.exports.forwardRef(function(t,a){const o=N({props:t,name:"MuiAccordionSummary"}),{children:c,className:n,expandIcon:s,focusVisibleClassName:i,onClick:l}=o,f=M(o,ft),{disabled:g=!1,disableGutters:d,expanded:b,toggle:A}=x.exports.useContext(ae),R=$=>{A&&A($),l&&l($)},p=u({},o,{expanded:b,disabled:g,disableGutters:d}),h=ht(p);return m(xt,u({focusRipple:!1,disableRipple:!0,disabled:g,component:"div","aria-expanded":b,className:v(h.root,n),focusVisibleClassName:v(h.focusVisible,i),onClick:R,ref:a,ownerState:p},f,{children:[r(vt,{className:h.content,ownerState:p,children:c}),s&&r(bt,{className:h.expandIconWrapper,ownerState:p,children:s})]}))});var yt=At;const Rt=Q(e=>({unRead:{boxShadow:"0 1px 2px 0 rgba(245,0,87,.16),0 1px 1px 0 rgba(245,0,87,.12),0 2px 1px -1px rgba(245,0,87,.1)","&:before":{backgroundColor:"rgba(245,0,87,.12)"}},summary:{"@media (max-width: 768px)":{paddingLeft:20,paddingRight:20},"@media (max-width: 600px)":{paddingLeft:16,paddingRight:16},"@media (max-width: 420px)":{paddingLeft:14,paddingRight:14}},content:{maxWidth:"100%",minWidth:0},moreUnRead:{color:"rgba(245,0,87,.7)"},avatar:{marginRight:10},title:{fontSize:16,lineHeight:"1.5em"},uname:{display:"block",fontWeight:700},time:{paddingLeft:10,"& div":{display:"flex",alignItems:"center","& svg":{marginRight:3}}},sizeAt:{fontSize:18,transform:"translateY(-1px)"},sizeReply:{fontSize:20,transform:"translateY(-1.5px)"},gray:{color:e.palette.mode==="light"?"rgba(0,0,0,.5)":"rgba(130,130,130,.5)"},actions:{paddingLeft:14,paddingRight:14,"@media (max-width: 600px)":{paddingTop:12,paddingBottom:12},"@media (max-width: 420px)":{paddingLeft:12,paddingRight:12}},btn:{padding:"6px 10px"},icon:{marginLeft:2,fontSize:14}})),Ct=({item:e,hasRead:t})=>{const a=Rt(),o=Z(),{accesstoken:c}=E(g=>g.auth),[n,s]=w.useState(L({},e)),i=w.useRef(!1),l=async()=>{i.current=!1;const{success:g}=await xe({accesstoken:c,msg_id:n.id});!i.current&&g&&(o({type:"message/read"}),s(d=>X(L({},d),{has_read:!0})))},f=()=>{n.has_read||l()};return w.useEffect(()=>()=>{i.current=!0},[]),m(et,{className:v({[a.unRead]:!n.has_read&&!t}),onChange:f,children:[r(yt,{classes:{root:a.summary,content:a.content,expandIconWrapper:v({[a.moreUnRead]:!n.has_read&&!t})},expandIcon:r(we,{}),children:m(y,{container:!0,wrap:"nowrap",alignItems:"center",children:[r(y,{className:a.avatar,item:!0,children:r(Re,{name:n.author.loginname,image:n.author.avatar_url})}),m(y,{container:!0,item:!0,zeroMinWidth:!0,wrap:"wrap",alignItems:"center",children:[r(y,{container:!0,item:!0,zeroMinWidth:!0,wrap:"wrap",alignItems:"center",children:r(z,{className:a.title,component:"h4",noWrap:!0,children:n.topic.title})}),m(y,{container:!0,item:!0,zeroMinWidth:!0,wrap:"nowrap",alignItems:"center",children:[r(y,{item:!0,zeroMinWidth:!0,children:r(z,{className:v(a.uname,a.gray),component:"span",noWrap:!0,children:n.author.loginname})}),r(y,{className:a.time,item:!0,children:m(z,{className:a.gray,component:"div",noWrap:!0,children:[n.type==="reply"?r(Se,{className:a.sizeReply}):r(te,{className:a.sizeAt}),he(n.reply.create_at).fromNow()]})})]})]})]})}),r(pt,{children:r($e,{markdownSource:n.reply.content})}),r(We,{}),m(st,{className:a.actions,children:[m(J,{className:a.btn,component:K,to:`/user/${n.author.loginname}`,target:"_blank",color:"secondary",size:"medium",children:["\u6D4F\u89C8\u7528\u6237",r(T,{className:a.icon})]}),m(J,{className:a.btn,component:K,to:`/topic/${n.topic.id}#${n.reply.id}`,target:"_blank",color:"primary",size:"medium",children:["\u4E3B\u9898\u4E2D\u67E5\u770B",r(T,{className:a.icon})]})]})]})},wt=Q(e=>({spacings:{marginTop:40,marginBottom:10,padding:"0 7px","@media (max-width: 768px)":{marginTop:30,marginBottom:8},"@media (max-width: 600px)":{marginTop:20,marginBottom:4}},text:{position:"relative",flex:1,marginRight:8,fontSize:14,color:e.palette.mode==="light"?"rgba(0,0,0,.6)":"rgba(190,190,190,.6)",pointerEvents:"none",transition:"opacity .15s cubic-bezier(.4,0,.2,1)","@media (max-width: 600px)":{marginRight:4},"& span":{position:"absolute",top:-9,right:0,whiteSpace:"nowrap"}},opacity:{opacity:.6},error:{color:e.palette.secondary.main}})),Wt=()=>{const e=wt(),t=Z(),{accesstoken:a}=E(d=>d.auth),o=E(d=>d.message),[c,n]=w.useState([]),[s,i]=w.useState({status:"loading"}),l=w.useRef(!1),f=()=>{c.map(d=>d.has_read=!0),n(c)},g=async()=>{l.current=!1;const{success:d}=await ye({accesstoken:a});!l.current&&d&&(f(),t({type:"message/readAll"}))};return w.useEffect(()=>{l.current=!1;const d=new AbortController;return i({status:"loading"}),(async()=>{if(!a)return;const{data:b,err_msg:A}=await ve({signal:d.signal,accesstoken:a,mdrender:!1});if(!l.current)if(b){const{hasnot_read_messages:R=[],has_read_messages:p=[]}=b;t({type:"message/update",payload:{count:R.length}}),i({status:"success"}),n([...R,...p])}else A&&i({status:"error",message:A})})(),()=>{l.current=!0,d.abort()}},[a,t]),m(be,{children:[m("div",{className:"wrapper",children:[m(y,{className:e.spacings,container:!0,alignItems:"center",justifyContent:"flex-end",children:[m(y,{className:v(e.text,{[e.opacity]:s.status!=="success"||o.count===0,[e.error]:s.status==="error"}),item:!0,children:[r(_,{unmountOnExit:!0,in:s.status==="loading",children:r("span",{children:"\u83B7\u53D6\u6D88\u606F\u4E2D\u2026\u2026"})}),r(_,{unmountOnExit:!0,in:s.status==="error",children:r("span",{children:s.message})}),r(_,{unmountOnExit:!0,in:s.status==="success"&&!c.length,children:r("span",{children:"\u6CA1\u6709\u6D88\u606F\u54E6"})}),r(_,{unmountOnExit:!0,in:s.status==="success"&&Boolean(c.length)&&!o.count,children:r("span",{children:"\u5DF2\u8BFB\u5168\u90E8\u6D88\u606F"})}),r(_,{unmountOnExit:!0,in:s.status==="success"&&Boolean(o.count),children:m("span",{children:[o.count," \u6761\u672A\u8BFB\u6D88\u606F"]})})]}),r(_e,{title:"\u5168\u90E8\u6807\u4E3A\u5DF2\u8BFB",placement:"left-start",enterDelay:500,disableHoverListener:o.count===0,disableTouchListener:!0,disableFocusListener:!0,children:r("span",{children:r(Ae,{size:"large",disableRipple:!0,disabled:s.status!=="success"||o.count===0,onClick:g,children:r(ee,{})})})})]}),c.map(d=>r(Ct,{item:d,hasRead:d.has_read},d.id))]}),r("div",{className:"status wrapper",children:r(Ce,{status:s.status})})]})};export{Wt as default};
