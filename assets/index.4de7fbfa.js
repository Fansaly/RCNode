var $=Object.defineProperty,j=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var M=(e,i,s)=>i in e?$(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s,o=(e,i)=>{for(var s in i||(i={}))S.call(i,s)&&M(e,s,i[s]);if(x)for(var s of x(i))E.call(i,s)&&M(e,s,i[s]);return e},c=(e,i)=>j(e,O(i));var w=(e,i)=>{var s={};for(var l in e)S.call(e,l)&&i.indexOf(l)<0&&(s[l]=e[l]);if(e!=null&&x)for(var l of x(e))i.indexOf(l)<0&&E.call(e,l)&&(s[l]=e[l]);return s};import{h as m,G as W,u as Y,a5 as G,aO as V,aP as _,a as P,R as C,j as b,A as Q,b as n,aQ as q,p as U,ae as J,T as K,W as X,aR as Z}from"./index.5e723353.js";import{s as ee}from"./user.ae17da9a.js";import{N as ae}from"./index.4c9ba486.js";import{C as te}from"./Collapse.9bf0d35a.js";import{T as ie}from"./TextField.b78d12af.js";import"./useFormControl.ee9cff0d.js";const se=e=>m.exports.createElement("svg",o({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1440 810",preserveAspectRatio:"xMinYMin slice","aria-hidden":"true"},e),m.exports.createElement("path",{id:"cell-4",fill:"#efefee",d:"M592.66 0c-15 64.092-30.7 125.285-46.598 183.777C634.056 325.56 748.348 550.932 819.642 809.5h419.672C1184.518 593.727 1083.124 290.064 902.637 0H592.66z"}),m.exports.createElement("path",{id:"cell-5",fill:"#f6f6f6",d:"M545.962 183.777c-53.796 196.576-111.592 361.156-163.49 490.74 11.7 44.494 22.8 89.49 33.1 134.883h404.07c-71.294-258.468-185.586-483.84-273.68-625.623z"}),m.exports.createElement("path",{id:"cell-6",fill:"#f7f7f7",d:"M153.89 0c74.094 180.678 161.088 417.448 228.483 674.517C449.67 506.337 527.063 279.465 592.56 0H153.89z"}),m.exports.createElement("path",{id:"cell-7",fill:"#fbfbfc",d:"M153.89 0H0v809.5h415.57C345.477 500.938 240.884 211.874 153.89 0z"}),m.exports.createElement("path",{id:"cell-3",fill:"#ebebec",d:"M1144.22 501.538c52.596-134.583 101.492-290.964 134.09-463.343 1.2-6.1 2.3-12.298 3.4-18.497 0-.2.1-.4.1-.6 1.1-6.3 2.3-12.7 3.4-19.098H902.536c105.293 169.28 183.688 343.158 241.684 501.638v-.1z"}),m.exports.createElement("path",{id:"cell-1",fill:"#e1e1e1",d:"M1285.31 0c-2.2 12.798-4.5 25.597-6.9 38.195C1321.507 86.39 1379.603 158.98 1440 257.168V0h-154.69z"}),m.exports.createElement("path",{id:"cell-2",fill:"#e7e7e7",d:"M1278.31,38.196C1245.81,209.874 1197.22,365.556 1144.82,499.838L1144.82,503.638C1185.82,615.924 1216.41,720.211 1239.11,809.6L1439.7,810L1439.7,256.768C1379.4,158.78 1321.41,86.288 1278.31,38.195L1278.31,38.196z"})),ne=W(e=>({svg:e.palette.mode==="light"?{}:{"& #cell-1":{fill:"#0d0d0c"},"& #cell-2":{fill:"#141413"},"& #cell-3":{fill:"#181817"},"& #cell-4":{fill:"#1c1d1c"},"& #cell-5":{fill:"#222322"},"& #cell-6":{fill:"#232423"},"& #cell-7":{fill:"#272727"}},root:{"&.success":{"& label":{color:"#508028"},"& .MuiInput-underline":{"&:hover:before":{borderBottomColor:e.palette.mode==="light"?"rgba(128,189,1,.87)":"rgba(108,168,3,.87)"},"&:before":{borderBottomColor:e.palette.mode==="light"?"#56b700":"#519217"},"&:after":{borderBottomColor:e.palette.mode==="light"?"#80bd01":"#519217"}}},"&.error":{"& label":{color:e.palette.mode==="light"?"#f44336":"#b92c22"},"& .MuiInput-underline":{"&:after":{borderBottomColor:e.palette.mode==="light"?"#f44336":"#b92c22"}}},"&.focus":{"& label":{color:"#46483e"},"& .MuiInput-underline":{"&:after":{borderBottomColor:"#46483e"}}},"& .MuiInput-underline":{"&:hover:before":{borderBottomWidth:1,borderBottomColor:"rgba(70,72,69,.8)"},"&:after":{borderBottomColor:"rgba(70,72,69,.8)"}}}})),me=()=>{const e=ne(),i=Y(),s=G(),l=V(),{status:I}=_(),k=P(a=>a.auth),{isAuthed:h}=k,N=w(k,["isAuthed"]),y=C.useRef(!1),[t,g]=C.useState(c(o({},N),{isAuthed:h,isUUID:h===!0,diff:h===!1,focus:h===!1,status:h?"success":"idle"})),[R,A]=C.useState({open:!1,status:"success",message:""}),z=()=>{g(a=>c(o({},a),{focus:!0}))},F=()=>{g(a=>c(o({},a),{focus:!1}))},D=a=>{const r=a.target.name,u=a.target.value.trim(),f=u===N.accesstoken;g(p=>c(o({},p),{[r]:u,isUUID:Z(u),diff:f===!1,status:f?"success":"idle"}))},L=async()=>{y.current=!1;const{accesstoken:a}=t,p=await ee({accesstoken:a}),{success:r,err_msg:u}=p,f=w(p,["success","err_msg"]);if(!y.current)if(r){const d={isAuthed:!0,accesstoken:a,avatar:f.avatar_url,uname:f.loginname,uid:f.id};l({type:"auth/update",payload:d}),g(v=>c(o(o({},v),d),{diff:!1,status:"success"}))}else g(d=>c(o({},d),{status:"error"})),u&&A(d=>c(o({},d),{open:!0,status:"error",message:u}))},H=a=>{a.preventDefault(),t.isUUID&&t.diff&&L()},T=()=>{var d,v,B;let a="/";const r=i.state,u=((d=r==null?void 0:r.from)==null?void 0:d.pathname)||"",f=((v=r==null?void 0:r.from)==null?void 0:v.search)||"",p=((B=r==null?void 0:r.from)==null?void 0:B.hash)||"";a=`${u}${f}${p}`||a,a=a.replace(/\s/g,""),s(a,{replace:!0})};return C.useEffect(()=>()=>{y.current=!0},[]),b(Q,{withHeader:!1,htmlAttributes:{id:"signin"},children:[b("div",{className:"container flex",children:[n(se,{className:`${e.svg} bg`}),n("div",{className:"flex area top"}),b("div",{className:"flex area mid",children:[n("div",{className:"logo",children:n(q,{color:"dark"})}),n(te,{in:t.isAuthed,children:t.isAuthed&&b("div",{className:U("auth-user",{show:t.isAuthed,diff:t.diff}),children:[n("div",{className:"avatar",children:n(J,{className:"item",alt:t.uname,src:t.avatar})}),n(K,{className:"name",children:n("span",{className:"item",children:t.uname})})]})}),b("form",{noValidate:!0,autoComplete:"off",onSubmit:H,children:[n(ie,{id:"accesstoken",className:U(e.root,t.status,{focus:t.focus}),margin:"normal",variant:"standard",fullWidth:!0,label:"Access Token",name:"accesstoken",value:t.accesstoken||"",error:t.status==="error",autoFocus:!t.isAuthed,spellCheck:"false",onFocus:z,onBlur:F,onChange:D}),n("div",{className:"btn",children:n(X,c(o({color:"inherit",variant:"outlined",disableFocusRipple:!0},t.diff?{type:"submit",disabled:!t.isUUID}:{autoFocus:t.isAuthed,disabled:I!=="success",onClick:T}),{children:t.diff?"\u6388\u6743":"\u5B8C\u6210"}))})]})]}),n("div",{className:"flex area bot"})]}),n(ae,c(o({},R),{onClose:()=>{A(a=>c(o({},a),{open:!1}))}}))]})};export{me as default};
